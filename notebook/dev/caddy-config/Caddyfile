import common.Caddyfile

# Notebook client subdomains → vite dev server

http://notebook.docker.localhost {
	reverse_proxy notebook-clients:5173
}

http://app.notebook.docker.localhost {
	reverse_proxy notebook-clients:5173
}

http://admin.notebook.docker.localhost {
	reverse_proxy notebook-clients:5173
}

http://account.notebook.docker.localhost {
	reverse_proxy notebook-clients:5173
}

# Hub client subdomains → static builds served by caddy

http://docker.localhost {
	import spa /hub-clients /root/index.html
}

http://app.docker.localhost {
	import spa /hub-clients /app/index.html
}

http://auth.docker.localhost {
	import spa /hub-clients /auth/index.html
}

http://account.docker.localhost {
	import spa /hub-clients /account/index.html
}

http://admin.docker.localhost {
	import spa /hub-clients /admin/index.html
}

# Notebook API

http://api.notebook.docker.localhost {
	import api-proxy monolith:3000 monolith:3003
}

# Identity service

http://identity.docker.localhost {
	import identity docker.localhost monolith:3000
}

# Azurite

http://azurite.docker.localhost {
	reverse_proxy azurite:10000 {
		header_up Host azurite:10000
		header_up X-Forwarded-Host {host}
	}
}
